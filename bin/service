#!/usr/bin/env php
<?php
require __DIR__ . '/../vendor/autoload.php';

use WakeOnStorage\Config;
use WakeOnStorage\ServiceManager;

if ($argc < 3) {
    fwrite(STDERR, "Usage: service <service> <up|down|status>\n");
    exit(1);
}

$service = $argv[1];
$action = $argv[2];

$serviceConfig = Config::load(__DIR__ . '/../config/services.yaml');
$manager = new ServiceManager($serviceConfig['services'] ?? []);

if (!$manager->has($service)) {
    fwrite(STDERR, "Unknown service\n");
    exit(1);
}

$result = $manager->run($service, $action);

echo json_encode($result) . PHP_EOL;
